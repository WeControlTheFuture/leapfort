<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>leapfort</title>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/sb-admin.css" rel="stylesheet">
<link href="css/font-awesome.min.css" rel="stylesheet" type="text/css">
<script src="js/jquery-1.12.3.js"></script>
<script src="js/term.js"></script>
</head>
<body>
	<div id="wrapper">
		<!-- Navigation -->
		<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
		<!-- Brand and toggle get grouped for better mobile display -->
		<div class="navbar-header">
			<button type="button" class="navbar-toggle" data-toggle="collapse"
				data-target=".navbar-ex1-collapse">
				<span class="sr-only">Toggle navigation</span> <span
					class="icon-bar"></span> <span class="icon-bar"></span> <span
					class="icon-bar"></span>
			</button>
			<a class="navbar-brand" href="index.html">LeapFort</a>
		</div>
		<!-- Top Menu Items -->
		<ul class="nav navbar-right top-nav">
			<li class="dropdown"><a href="#" class="dropdown-toggle"
				data-toggle="dropdown"><i class="fa fa-envelope"></i> <b
					class="caret"></b></a>
				<ul class="dropdown-menu message-dropdown">
					<li class="message-preview"><a href="#">
							<div class="media">
								<span class="pull-left"> <img class="media-object"
									src="http://placehold.it/50x50" alt="">
								</span>
								<div class="media-body">
									<h5 class="media-heading">
										<strong>John Smith</strong>
									</h5>
									<p class="small text-muted">
										<i class="fa fa-clock-o"></i> Yesterday at 4:32 PM
									</p>
									<p>Lorem ipsum dolor sit amet, consectetur...</p>
								</div>
							</div>
					</a></li>
					<li class="message-preview"><a href="#">
							<div class="media">
								<span class="pull-left"> <img class="media-object"
									src="http://placehold.it/50x50" alt="">
								</span>
								<div class="media-body">
									<h5 class="media-heading">
										<strong>John Smith</strong>
									</h5>
									<p class="small text-muted">
										<i class="fa fa-clock-o"></i> Yesterday at 4:32 PM
									</p>
									<p>Lorem ipsum dolor sit amet, consectetur...</p>
								</div>
							</div>
					</a></li>
					<li class="message-preview"><a href="#">
							<div class="media">
								<span class="pull-left"> <img class="media-object"
									src="http://placehold.it/50x50" alt="">
								</span>
								<div class="media-body">
									<h5 class="media-heading">
										<strong>John Smith</strong>
									</h5>
									<p class="small text-muted">
										<i class="fa fa-clock-o"></i> Yesterday at 4:32 PM
									</p>
									<p>Lorem ipsum dolor sit amet, consectetur...</p>
								</div>
							</div>
					</a></li>
					<li class="message-footer"><a href="#">Read All New
							Messages</a></li>
				</ul></li>
			<li class="dropdown"><a href="#" class="dropdown-toggle"
				data-toggle="dropdown"><i class="fa fa-bell"></i> <b
					class="caret"></b></a>
				<ul class="dropdown-menu alert-dropdown">
					<li><a href="#">Alert Name <span
							class="label label-default">Alert Badge</span></a></li>
					<li><a href="#">Alert Name <span
							class="label label-primary">Alert Badge</span></a></li>
					<li><a href="#">Alert Name <span
							class="label label-success">Alert Badge</span></a></li>
					<li><a href="#">Alert Name <span class="label label-info">Alert
								Badge</span></a></li>
					<li><a href="#">Alert Name <span
							class="label label-warning">Alert Badge</span></a></li>
					<li><a href="#">Alert Name <span
							class="label label-danger">Alert Badge</span></a></li>
					<li class="divider"></li>
					<li><a href="#">View All</a></li>
				</ul></li>
			<li class="dropdown"><a href="#" class="dropdown-toggle"
				data-toggle="dropdown"><i class="fa fa-user"></i> John Smith <b
					class="caret"></b></a>
				<ul class="dropdown-menu">
					<li><a href="#"><i class="fa fa-fw fa-user"></i> Profile</a></li>
					<li><a href="#"><i class="fa fa-fw fa-envelope"></i> Inbox</a>
					</li>
					<li><a href="#"><i class="fa fa-fw fa-gear"></i> Settings</a>
					</li>
					<li class="divider"></li>
					<li><a href="#"><i class="fa fa-fw fa-power-off"></i> Log
							Out</a></li>
				</ul></li>
		</ul>
		<!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
		<div class="collapse navbar-collapse navbar-ex1-collapse">
			<ul class="nav navbar-nav side-nav">
			</ul>
		</div>
		</nav>
		<div id="page-wrapper" style="padding-left: 0">
			<script type="text/javascript">
			computeMaxTerminalSize = function() {
				rows = Math.round($(window).height() / 14);
				cols = Math.round($(window).width() / 6.8);
				return {
					cols : cols,
					rows : rows
				};
			};

			var connectionId, doneResizing, evt, term;
			connectionId = null;
			termSize = computeMaxTerminalSize()
			term = new Terminal({
				cols : termSize.cols,
				rows : termSize.rows,
				useStyle : true,
				screenKeys : true,
				cursorBlink : true
			});

			evt = new EventSource("/leapfort/ssh/stream");
			evt.addEventListener('connectionId', function(event) {
				connectionId = event.data;
				term.write("Connection established\r\n");
				doneResizing();
			});
			evt.addEventListener('data', function(event) {
				console.log('data', event);
				term.write(JSON.parse(event.data));
			});
			evt.addEventListener('exit', function() {
				evt.close();
				term.write("\r\nTerminal exited.");
			});
			evt.addEventListener('error', function() {
				evt.close();
				term.write("\r\nTerminal exited.");
			});

			term.on('data', function(data) {
				if (evt.readyState === EventSource.OPEN) {
					$.post("/leapfort/ssh/send/" + connectionId, {
						data : data
					});
				}
			});
			term.on('title', function(title) {
				document.title = title;
			});
			var page_wrapper_div = $("#page-wrapper");
			console.log(page_wrapper_div);
			term.open(page_wrapper_div);

			window.onresize = function(event) {
				clearTimeout(this.id);
				this.id = setTimeout(doneResizing, 500);
			};
			doneResizing = function() {
				maxTermSize = computeMaxTerminalSize();
				$.post("/api/v1/terminal/resize-window/" + connectionId, maxTermSize,
						function(data) {
							if (data && data.cols && data.rows) {
								term.resize(data.cols, data.rows);
							}
						});
			};	
			</script>
		</div>

	</div>

	
	<script src="js/bootstrap.min.js"></script>
	
	<script src="js/leapfort.js"></script>
</body>
</html>